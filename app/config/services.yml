# Learn more about services, parameters and containers at
# https://symfony.com/doc/current/service_container.html
parameters:
    referencias_bancarias_dir: '%kernel.root_dir%/../var/referencias_bancarias'
    zip_referencias_bancarias_dir: '%kernel.root_dir%/../var/Referenciasbancarias.zip'
    formato_fofoe_dir: '%kernel.root_dir%/../var/formato_fofoe'
    credenciales_dir: '%kernel.root_dir%/../var/credenciales'
    comprobantes_pago_dir: '/uploads/files/instituciones'
    cedula_identificacion_pago_dir: '/uploads/files/instituciones'

imports:
    - { resource: './services/repositories.yml' }

services:
    # default configuration for services in *this* file
    _defaults:
        # automatically injects dependencies in your services
        autowire: true
        # automatically registers your services as commands, event subscribers, etc.
        autoconfigure: true
        # this means you cannot fetch services directly from the container via $container->get()
        # if you need to do this, you can override this setting on individual services
        public: false

        bind:
            $comprobantesPagoDir: '%comprobantes_pago_dir%'
            $cedulaIdentificacionDir: '%cedula_identificacion_pago_dir%'
            $zipReferenciasBancariasDir: '%zip_referencias_bancarias_dir%'
            $institucionDocumentsDir: '%app.path.instituciones%'

    # makes classes in src/AppBundle available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    AppBundle\:
        resource: '../../src/AppBundle/*'
        # you can exclude directories or files
        # but if a service is unused, it's removed anyway
        exclude: '../../src/AppBundle/{Entity,Repository,Tests}'

    # controllers are imported separately to make sure they're public
    # and have a tag that allows actions to type-hint services
    AppBundle\Controller\:
        resource: '../../src/AppBundle/Controller'
        public: true
        tags: ['controller.service_arguments']
    # add more services, or override services that need manual wiring
    # AppBundle\Service\ExampleService:
    #     arguments:
    #         $someArgument: 'some_value'

    AppBundle\Vich\Naming\CedulaNamer:
        public: true

    AppBundle\Vich\Naming\ComprobantePagoNamer:
        public: true

    AppBundle\Vich\Naming\ComprobanteInscripcionNamer:
        public: true

    AppBundle\Vich\Naming\FacturaNamer:
        public: true

    AppBundle\DataFixtures\:
        resource: '../../src/AppBundle/DataFixtures'

    AppBundle\Service\InstitucionManagerInterface:
        class: AppBundle\Service\InstitucionManager
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@logger'
        public: true

    AppBundle\Service\MontoCarreraManagerInterface:
        class: AppBundle\Service\MontoCarreraManager
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@logger'
        public: true

    AppBundle\Service\ConvenioManagerInterface:
        class: AppBundle\Service\ConvenioManager
        arguments:
            - '@doctrine.orm.entity_manager'
        public: true

    AppBundle\EventListener\ComprobantePagoUploadedListener:
        tags:
            - { name: kernel.event_listener, event: vich_uploader.post_upload, method: comprobantePagoUploaded }

    app.directory_namer.institucion:
        class: AppBundle\Vich\Naming\InstitucionDirectoryNamer
        public: true

    AppBundle\Service\ProcesadorFormaPagoInterface:
        class: AppBundle\Service\ProcesadorFormaPago
        public: true

    Knp\Snappy\Pdf:
        public: true
        arguments:
            - '%wkhtmltopdf_path%'

    AppBundle\Service\GeneradorReferenciaBancariaPDFInterface:
        class: AppBundle\Service\GeneradorReferenciaBancariaPDF
        public: true

    AppBundle\Service\GeneradorReferenciaBancariaZIPInterface:
        class: AppBundle\Service\GeneradorReferenciaBancariaZIP
        public: true
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@AppBundle\Service\GeneradorReferenciaBancariaPDF'
            - '@event_dispatcher'
            - '%referencias_bancarias_dir%'

    AppBundle\Service\SolicitudManagerInterface:
        class: AppBundle\Service\SolicitudManager
        public: true
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@Psr\Log\LoggerInterface'
            - '@Swift_Mailer'
            - '@Twig_Environment'
            - '@Symfony\Component\Security\Core\Encoder\EncoderFactoryInterface'
            - '%mailer_sender%'

    app.bank_references_created.event:
        class: AppBundle\EventListener\BankReferencesCreatedListener
        tags:
            - { name: kernel.event_listener, event: bank_references.created, method: handleBankReferencesCreated }

    app.bank_references_unloaded.event:
        class: AppBundle\EventListener\ReferenciaBancariaZipUnloadedListener
        tags:
            - { name: kernel.event_listener, event: referencia_bancaria_zip.unloaded, method: referenciaBancariaZipUnloaded }

    app.gestion_pago_normalizer:
        class: AppBundle\Normalizer\GestionPagoNormalizer
        public: true
        tags: ['serializer.normalizer']

    app.cedula_identificacion_normalizer:
        class: AppBundle\Normalizer\CedulaIdentificacionNormalizer
        public: true
        tags: ['serializer.normalizer']

    app.institucion_voter:
        class: AppBundle\Security\Voter\SolicitudVoter
        tags: ['security.voter']

    AppBundle\Repository\GetExistSolicitud\GetExistSolicitud:
        class: AppBundle\Repository\GetExistSolicitud\GetExistSolicitudUsingSql
        public: true

    AppBundle\Repository\IE\SeleccionarFormaPago\ListaCamposClinicosAutorizados\CamposClinicos:
        class: AppBundle\Repository\IE\SeleccionarFormaPago\ListaCamposClinicosAutorizados\CamposClinicosUsingSql
        public: true

    app.formato_fofoe_normalizer:
        class: AppBundle\Normalizer\FormatoFOFOENormalizer
        public: true
        tags: ['serializer.normalizer']

    AppBundle\Repository\IE\DetalleSolicitud\ListaCamposClinicos\CamposClinicos:
        class: AppBundle\Repository\IE\DetalleSolicitud\ListaCamposClinicos\CamposClinicosUsingSql
        public: true

    AppBundle\Repository\IE\DetalleSolicitud\TotalCamposClinicosAutorizados\TotalCamposClinicos:
        class: AppBundle\Repository\IE\DetalleSolicitud\TotalCamposClinicosAutorizados\TotalCamposClinicosUsingSql
        public: true

    AppBundle\Repository\IE\DetalleSolicitud\DetalleSolicitud:
        class: AppBundle\Repository\IE\DetalleSolicitud\DetalleSolicitudUsingSql
        public: true

    AppBundle\Repository\IE\DetalleSolicitud\Expediente\Expediente:
        class: AppBundle\Repository\IE\DetalleSolicitud\Expediente\ExpedienteUsingSql
        public: true

    app.oficio_montos_normalizer:
        class: AppBundle\Normalizer\OficioMontosNormalizer
        public: true
        tags: ['serializer.normalizer']

    app.comprobante_pago_normalizer:
        class: AppBundle\Normalizer\ComprobantePagoNormalizer
        public: true
        tags: ['serializer.normalizer']

    app.factura_normalizer:
        class: AppBundle\Normalizer\FacturaNormalizer
        public: true
        tags: ['serializer.normalizer']


    AppBundle\Repository\IE\DetalleSolicitudMultiple\DetalleSolicitudMultiple:
        class: AppBundle\Repository\IE\DetalleSolicitudMultiple\DetalleSolicitudMultipleUsingSql
        public: true

    AppBundle\Repository\IE\DetalleSolicitudMultiple\Expediente\Expediente:
        class: AppBundle\Repository\IE\DetalleSolicitudMultiple\Expediente\ExpedienteUsingSql
        public: true

    AppBundle\Repository\IE\DetalleSolicitudMultiple\ListaCamposClinicos\CamposClinicos:
        class: AppBundle\Repository\IE\DetalleSolicitudMultiple\ListaCamposClinicos\CamposClinicosUsingSql
        public: true
